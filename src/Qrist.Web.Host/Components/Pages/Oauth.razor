@page "/Todoist/Oauth"
@using System.Threading
@using Qrist.Adapters.Todoist
@inject ITodoistAuthoriser TodoistAuthoriser
@inject NavigationManager NavigationManager

<h3>ProcessCode</h3>

@code {

    [SupplyParameterFromQuery(Name = "code")]
    private string Code { get; set; }

    [SupplyParameterFromQuery(Name = "state")]
    private string State { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var accessToken =
            await
                TodoistAuthoriser
                    .GetAccessTokenAsync(Code, CancellationToken.None);

        if (string.IsNullOrEmpty(accessToken))
            throw new Exception("There was an error.");

        // TODO: delete this. QR code, state, and session identifier should go in scoped / singleton resolver

        NavigationManager
            .NavigateTo($"/Todoist/ProcessAction/{Code}");
    }

}